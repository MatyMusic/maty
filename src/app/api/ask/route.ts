// src/app/api/ai/ask/route.ts
import { NextResponse } from "next/server";

type Mode = "setlist" | "lyrics" | "tips";

export async function POST(req: Request) {
  let body: any = {};
  try {
    body = await req.json();
  } catch {
    body = {};
  }

  const mode: Mode = body?.mode || "setlist";
  const prompt: string = body?.prompt || "";

  let answer = "";

  if (mode === "setlist") {
    answer = [
      "סט ראשוני לפי מה שכתבת:",
      "",
      "1. פתיחה רגועה – אינסטרומנטלי/ניגון שקט לחימום האווירה.",
      '2. קטע חסידי/חב"ד מוכר שהקהל יוכל לשיר יחד.',
      "3. מעבר למזרחי קצבי לפי הטעם שציינת.",
      "4. שיר מרכזי/שיא הערב לפי סגנון האירוע.",
      "5. סיום רגוע – שיר הודיה/עוצמה שמסכם את המסר.",
      "",
      "זה רק שלד. מתי יכול להתאים את השירים עצמם בדיוק לקהל ולאירוע.",
    ].join("\n");
  } else if (mode === "lyrics") {
    answer = [
      "טקסט ראשוני לשיר אישי (טיוטה):",
      "",
      "בית 1:",
      "בין כל הרעש, אתה אור בתוך הלב,",
      "צחוק שלך מדביק אותי כמו אש שלא תכבה.",
      "כל צעד בחיים שלנו, עוד פסוק בתוך השיר,",
      "מתפלל עליך בלילה, שתמיד תמשיך לשיר.",
      "",
      "פזמון:",
      "אתה המתנה שלי מהשמיים,",
      "בלב שלי חקוק לך בית לעד.",
      "בכל יום שעובר אני יודע,",
      "שזה רק אנחנו והדרך ביחד.",
      "",
      "אפשר לערוך, לשנות שמות, ולהתאים בדיוק לאדם ולאירוע.",
    ].join("\n");
  } else {
    // tips
    answer = [
      "טיפים ראשוניים להופעה/אירוע:",
      "",
      "• להתחיל בשירים מוכרים ופשוטים שהקהל יכול להצטרף מהר.",
      "• לשלב מדי פעם דיבור קצר, אישי וחיובי – לא רק שירה רצופה.",
      "• לבנות את הערב בגלים – רגוע, קצבי, שיא, ירידה עדינה.",
      "• להתאים את הסאונד לעומק הקהל – לא חזק מדי, לא חלש מדי.",
      "• לסיים תמיד בשיר עם מסר טוב, שהקהל יוצא איתו הביתה.",
      "",
      "אפשר לבקש מהמחשב רעיונות נוספים למבנה ערב ספציפי לפי סוג האירוע.",
    ].join("\n");
  }

  // תמיד מחזיר 200, עם מבנה קבוע
  return NextResponse.json(
    {
      ok: true,
      mode,
      prompt,
      answer,
    },
    { status: 200 },
  );
}

// למקרה שמישהו ייכנס ב-GET, נקבל תשובה ברורה (גם 200)
export async function GET() {
  return NextResponse.json(
    {
      ok: false,
      error: "Use POST with JSON { mode, prompt }",
    },
    { status: 200 },
  );
}
